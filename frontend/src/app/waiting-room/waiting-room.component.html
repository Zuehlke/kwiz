<div class="waiting-room-container">
  <h1>Waiting Room</h1>

  @if (quizDetails) {
    <div class="quiz-info">
      <h2>{{ quizDetails.quizName }}</h2>
      <p>Quiz ID: {{ quizId }}</p>
      <p>Waiting for the quiz to start...</p>
      <p>Players: {{ quizDetails.playerCount }} / {{ quizDetails.maxPlayers }}</p>
    </div>

    <div class="status-info">
      <div class="status-indicator" [class.active]="!quizDetails.started">
        <span class="status-dot"></span>
        <span class="status-text">Waiting for quiz master to start the quiz</span>
      </div>
    </div>

    <!-- Question submission form -->
    @if (!quizDetails.started) {
      <div class="question-submission">
        <h3>Submit Your Own Question</h3>
        <p>While waiting, you can create and submit your own questions for the quiz!</p>

        @if (errorMessage) {
          <div class="error-message">{{ errorMessage }}</div>
        }

        @if (questionSubmitted) {
          <div class="success-message">Question submitted successfully!</div>
        }

        <form (ngSubmit)="submitQuestion()">
          <div class="form-group">
            <label for="questionText">Question:</label>
            <textarea 
              id="questionText" 
              name="questionText" 
              [(ngModel)]="newQuestion.questionText" 
              required
              placeholder="Enter your question here"
              rows="3"
            ></textarea>
          </div>

          <div class="form-group">
            <label>Correct Answers:</label>
            @for (answer of newQuestion.correctAnswers; track $index) {
              <div class="answer-input">
                <input 
                  type="text" 
                  [(ngModel)]="newQuestion.correctAnswers[$index]" 
                  name="correctAnswer{{$index}}" 
                  placeholder="Enter a correct answer"
                  required
                >
                @if (newQuestion.correctAnswers.length > 1) {
                  <button type="button" class="remove-btn" (click)="removeCorrectAnswer($index)">Remove</button>
                }
              </div>
            }
            <button type="button" class="add-btn" (click)="addCorrectAnswer()">Add Another Answer</button>
          </div>

          <div class="form-group">
            <label for="timeLimit">Time Limit (seconds):</label>
            <input 
              type="number" 
              id="timeLimit" 
              name="timeLimit" 
              [(ngModel)]="newQuestion.timeLimit" 
              min="5" 
              max="120"
              required
            >
          </div>

          <button type="submit" [disabled]="submittingQuestion">
            {{ submittingQuestion ? 'Submitting...' : 'Submit Question' }}
          </button>
        </form>

        <!-- Display submitted questions -->
        <div class="submitted-questions">
          <h3>Your Submitted Questions</h3>

          @if (loadingQuestions) {
            <p>Loading your questions...</p>
          } @else if (submittedQuestions.length === 0) {
            <p>You haven't submitted any questions yet.</p>
          } @else {
            <ul class="questions-list">
              @for (question of submittedQuestions; track question.questionId) {
                <li class="question-item">
                  <div class="question-text">{{ question.questionText }}</div>
                  <div class="question-details">
                    <div class="correct-answers">
                      <strong>Correct Answers:</strong>
                      <span>{{ question.correctAnswers.join(', ') }}</span>
                    </div>
                    <div class="time-limit">
                      <strong>Time Limit:</strong> {{ question.timeLimit }} seconds
                    </div>
                  </div>
                </li>
              }
            </ul>
          }
        </div>
      </div>
    }
  } @else {
    <div class="loading">
      <p>Loading quiz details...</p>
    </div>
  }
</div>
